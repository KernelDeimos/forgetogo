(this.webpackJsonpui=this.webpackJsonpui||[]).push([[0],{33:function(t,e,n){},47:function(t,e,n){},48:function(t,e,n){},49:function(t,e,n){},53:function(t,e,n){"use strict";n.r(e);var r=n(0),a=n.n(r),i=n(24),s=n.n(i),c=(n(33),n(9)),o=n(2),u=n.n(o),l=n(8),h=n(3),p=n(5),f=n(7),b=n(6),d=function t(e){Object(h.a)(this,t),this.path="",this.path=e},j=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){return Object(h.a)(this,n),e.call(this,t)}return Object(p.a)(n,[{key:"matches",value:function(){var t=this.props.rs.path,e=this.props.path;return t.startsWith(e)}},{key:"render",value:function(){return this.matches()?this.props.children:[]}}]),n}(a.a.Component);function v(t){return new d(t)}var O=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return[]}}]),n}(a.a.Component),m=n(13);function g(t){return x.apply(this,arguments)}function x(){return(x=Object(l.a)(u.a.mark((function t(e){var n,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(e);case 3:if(200===(n=t.sent).status){t.next=12;break}return t.t0="server responded with status: "+n.status,t.t1={url:e},t.next=9,n.text();case 9:return t.t2=t.sent,t.t3=[t.t0,t.t1,t.t2],t.abrupt("return",["error",t.t3]);case 12:return t.next=14,n.json();case 14:return r=t.sent,t.abrupt("return",[!1,r]);case 18:return t.prev=18,t.t4=t.catch(0),t.abrupt("return",["error",["an exception occurred during a request",{url:e},t.t4.message]]);case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))).apply(this,arguments)}function y(t,e){return k.apply(this,arguments)}function k(){return(k=Object(l.a)(u.a.mark((function t(e,n){var r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("payload",JSON.stringify(n)),t.prev=1,t.next=4,fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});case 4:if(200===(r=t.sent).status){t.next=13;break}return t.t0="server responded with status: "+r.status,t.t1={url:e},t.next=10,r.text();case 10:return t.t2=t.sent,t.t3=[t.t0,t.t1,t.t2],t.abrupt("return",["error",t.t3]);case 13:return t.next=15,r.json();case 15:return a=t.sent,t.abrupt("return",[!1,a]);case 19:return t.prev=19,t.t4=t.catch(1),t.abrupt("return",["error",["an exception occurred during a request",{url:e},t.t4.message]]);case 22:case"end":return t.stop()}}),t,null,[[1,19]])})))).apply(this,arguments)}var w=n(19),C=n(20),S=n(1),T=function(){function t(e){var n=this;Object(h.a)(this,t),this.fields=e.map((function(t){return n.normalizeField(t)}))}return Object(p.a)(t,[{key:"getFormik",value:function(){var t=this;return Object(S.jsx)(m.c,{initialValues:this.fieldsToInitials(this.fields),onSubmit:this.onSubmit,children:function(e){var n=e.isSubmitting;return t.createForm(n)}})}},{key:"createForm",value:function(t){var e=this;return Object(S.jsxs)(m.b,{children:[this.fields.map((function(t){return e.fieldToElem(t)})).flat(),Object(S.jsx)("div",{}),Object(S.jsx)("button",{type:"submit",disabled:t,children:"Submit"})]})}},{key:"normalizeField",value:function(t){var e=Object(C.a)({},t);return e.type||(e.type="text"),e}},{key:"fieldToInitial",value:function(t){var e={text:"",hidden:"",integer:1,checkbox:!0}[t.type];return void 0===e&&(e=""),void 0!==t.initial&&(e=t.initial),e}},{key:"fieldsToInitials",value:function(t){var e,n={},r=Object(w.a)(t);try{for(r.s();!(e=r.n()).done;){var a=e.value;n[a.name]=this.fieldToInitial(a)}}catch(i){r.e(i)}finally{r.f()}return n}},{key:"fieldToElem",value:function(t){var e;return e="integer"===t.type?Object(S.jsx)(m.a,{name:t.name,type:"number",min:"1",step:"1",pattern:"\\d*"}):"hidden"===t.type?[]:Object(S.jsx)(m.a,{name:t.name,type:t.type}),[Object(S.jsx)("label",{htmlFor:t.name,children:t.label||t.name}),e]}}]),t}(),F=n(14),N=n(16),P=a.a.createContext({tabs:[],activeTab:null}),B=function t(e,n,r){Object(h.a)(this,t),this.id=e,this.label=n,this.elem=r},I=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).state={tabs:t.tabs,activeTab:t.activeTab,addTab:r.addTab.bind(Object(N.a)(r)),switchTab:r.switchTab.bind(Object(N.a)(r))},r}return Object(p.a)(n,[{key:"addTab",value:function(t,e,n,r){var a,i=Object(w.a)(this.state.tabs);try{for(i.s();!(a=i.n()).done;){if(a.value.id==t)return void this.setState({activeTab:t})}}catch(s){i.e(s)}finally{i.f()}this.setState(Object(C.a)({tabs:[].concat(Object(F.a)(this.state.tabs),[new B(t,e,n)])},r?{}:{activeTab:t}))}},{key:"switchTab",value:function(t){this.setState({activeTab:t})}},{key:"render",value:function(){return Object(S.jsx)(P.Provider,{value:this.state,children:this.props.children})}}]),n}(a.a.Component),D=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(S.jsx)("div",{class:"common-tabs",children:Object(S.jsx)(P.Consumer,{children:function(t){return t.tabs.map((function(e){var n="common-tab",r=!1;return e.id==t.activeTab&&(n+=" common-tab-active",r=!0),Object(S.jsx)("button",{className:n,onClick:r?function(){}:function(){t.switchTab(e.id)},children:e.label})}))}})})}}]),n}(a.a.Component),E=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(S.jsx)(P.Consumer,{children:function(t){var e=t.tabs.find((function(e){return e.id==t.activeTab}));return e?e.elem:[]}})}}]),n}(a.a.Component),L=n(27),J=n.n(L),M=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).state={lines:[],scrolling:!1,commandLine:""},r.consoleEndRef=a.a.createRef(),r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.init(),this.updateScrollPosition()}},{key:"componentWillUnmount",value:function(){this.consoleSocket.close()}},{key:"componentDidUpdate",value:function(){this.updateScrollPosition()}},{key:"updateScrollPosition",value:function(){if(!this.state.scrolling){var t=this.consoleEndRef.current;t?t.scrollIntoView({behaviour:"smooth"}):console.warn("console end not found")}}},{key:"onConsoleScroll",value:function(t){var e=t.target;e.scrollHeight-e.clientHeight>e.scrollTop&&this.setState({scrolling:!0})}},{key:"init",value:function(){var t=Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.populateBuffer();case 2:this.initConsoleSocket();case 3:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"populateBuffer",value:function(){var t=Object(l.a)(u.a.mark((function t(){var e,n,r,a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(window.location.origin+"/instance/buffer/"+this.props.uuid);case 2:if(e=t.sent,n=Object(c.a)(e,2),r=n[0],a=n[1],!r){t.next=10;break}return alert("error"),console.error(a),t.abrupt("return");case 10:this.setState({lines:a});case 11:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initConsoleSocket",value:function(){var t=this;this.consoleSocket=new WebSocket("ws://".concat(window.location.host,"/instance/stream/")+this.props.uuid),this.consoleSocket.onmessage=function(e){t.setState({lines:[].concat(Object(F.a)(t.state.lines),Object(F.a)((""+e.data).split("\n")))})}}},{key:"onCommandEntered",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,i,s,o;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.preventDefault(),n=this.state.commandLine,t.next=4,y(window.location.origin+"/instance/command/"+this.props.uuid,n);case 4:if(r=t.sent,a=Object(c.a)(r,2),i=a[0],s=a[1],!i){t.next=12;break}return alert("error running command"),console.error(s),t.abrupt("return");case 12:o="<you entered> ".concat(n),this.setState({lines:[].concat(Object(F.a)(this.state.lines),[o])});case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"handleCommandLine",value:function(t){this.setState({commandLine:t.target.value})}},{key:"render",value:function(){var t=this;return Object(S.jsxs)("div",{className:"app-serverconsole",children:[Object(S.jsxs)("div",{className:"app-serverconsole-console",onScroll:this.onConsoleScroll.bind(this),children:[this.state.scrolling?Object(S.jsx)("button",{className:"app-serverconsole-scrollbtn",onClick:function(){t.setState({scrolling:!1})},children:"Follow Output"}):[],this.state.lines.map((function(t){return Object(S.jsx)("div",{className:"app-serverconsole-line",children:Object(S.jsx)(J.a,{children:t})})})),Object(S.jsx)("div",{ref:this.consoleEndRef})]}),Object(S.jsxs)("form",{className:"app-serverconsole-entry",onSubmit:this.onCommandEntered.bind(this),children:[Object(S.jsx)("input",{name:"cmd",value:this.state.commandLine,onChange:this.handleCommandLine.bind(this)}),Object(S.jsx)("input",{type:"submit",value:">"})]})]})}}]),n}(a.a.Component),R=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(S.jsxs)("div",{class:"app-noconfig",children:[Object(S.jsx)("h1",{children:"No configuration found!"}),Object(S.jsx)("p",{children:"Click the button below to proceed in the working directory."}),Object(S.jsx)("input",{type:"button",value:"Create Config",onClick:this.props.onCreateConfig})]})}}]),n}(a.a.Component),U=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(S.jsxs)("div",{children:[Object(S.jsx)("h1",{children:"Error reading configuration"}),Object(S.jsx)("pre",{children:JSON.stringify(this.props.info,null,"  ")})]})}}]),n}(a.a.Component),G=[{name:"name",label:"Server Name"},{name:"jarFile",label:"Jar File"},{name:"heapMin",label:"Heap (min)",type:"integer",initial:5},{name:"heapMax",label:"Heap (max)",type:"integer",initial:5},{name:"enableG1GC",label:"Enable G1GC",type:"checkbox",initial:!0}],H=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(){return Object(h.a)(this,n),e.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var t=this,e=new T(G);return e.onSubmit=function(){var e=Object(l.a)(u.a.mark((function e(n){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.props.onSubmit(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Object(S.jsxs)("div",{className:"app-createconfig",children:[Object(S.jsx)("h1",{children:"Create config"}),e.getFormik()]})}}]),n}(a.a.Component),W=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).state={launchDisabled:!1,stopDisabled:!1},r}return Object(p.a)(n,[{key:"launch",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,i,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({launchDisabled:!0}),n=this.props.config,console.log("config?",n),t.next=5,y(window.location.origin+"/instance/instance/"+n.uuid,{});case 5:if(r=t.sent,a=Object(c.a)(r,2),i=a[0],s=a[1],!i){t.next=13;break}return console.error(s),alert("operation failed"),t.abrupt("return");case 13:this.open(e),console.log("post instance",s);case 15:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"open",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=this.props.config,e("server."+n.uuid,"Server: "+n.values.name,Object(S.jsx)(M,{uuid:n.uuid}));case 2:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"terminate",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,i,s;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({stopDisabled:!0}),n=this.props.config,t.next=4,y(window.location.origin+"/instance/command/"+n.uuid,"stop");case 4:r=t.sent,a=Object(c.a)(r,2),i=a[0],s=a[1],i&&(alert("error stopping server"),console.error(s));case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getControlsForInstance",value:function(){if(!this.props.instance)throw new Error("this should only be called if an instance exists");var t=this.props.instance.status;return"running"==t?[this.getOpenButton(),this.getStopButton("Stop")]:"crashed"==t||"stopped"==t?[this.getOpenButton(),this.getStartButton("Restart")]:[]}},{key:"getStartButton",value:function(t){var e=this;return Object(S.jsx)(P.Consumer,{children:function(n){return Object(S.jsx)("button",{className:"btn-primary",onClick:e.launch.bind(e,n.addTab),disabled:e.state.launchDisabled,children:t})}})}},{key:"getStopButton",value:function(t){var e=this;return Object(S.jsx)(P.Consumer,{children:function(n){return Object(S.jsx)("button",{className:"btn-primary",onClick:e.terminate.bind(e,n.addTab),disabled:e.state.stopDisabled,children:t})}})}},{key:"getOpenButton",value:function(){var t=this;return Object(S.jsx)(P.Consumer,{children:function(e){return Object(S.jsx)("button",{className:"btn-primary",onClick:t.open.bind(t,e.addTab),children:"Console"})}})}},{key:"render",value:function(){var t=this.props.config;return Object(S.jsxs)("div",{className:"app-listconfigs-config",children:[Object(S.jsx)("div",{class:"app-listconfigs-config-title",children:t.values.name}),Object(S.jsx)("div",{class:"app-listconfigs-config-status",children:this.props.instance?this.props.instance.status:"not running"}),Object(S.jsx)("div",{class:"app-listconfigs-config-controls",children:this.props.instance?this.getControlsForInstance():this.getStartButton("Launch")})]})}}]),n}(a.a.Component),q=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).configPoller=null,r.state={configs:t.configs,instances:t.instances,loading:!0},r}return Object(p.a)(n,[{key:"componentDidMount",value:function(){this.configPoller=this.startConfigPoller()}},{key:"componentWillUnmount",value:function(){this.configPoller&&clearTimeout(this.configPoller)}},{key:"startConfigPoller",value:function(){var t=this;this.configPoller=setTimeout(Object(l.a)(u.a.mark((function e(){var n,r,a,i,s,o,l,h;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("poll start"),e.next=3,g(window.location.origin+"/config/launchers");case 3:if(n=e.sent,r=Object(c.a)(n,2),a=r[0],i=r[1],!a){e.next=10;break}return console.error(i),e.abrupt("return");case 10:return e.next=12,g(window.location.origin+"/instance/instances");case 12:if(s=e.sent,o=Object(c.a)(s,2),l=o[0],h=o[1],!l){e.next=19;break}return console.error(h),e.abrupt("return");case 19:t.setState({configs:i,instances:h,loading:!1}),console.log("poll end"),t.startConfigPoller();case 22:case"end":return e.stop()}}),e)}))),400)}},{key:"render",value:function(){var t=this;return console.log("list configs render"),this.state.loading?Object(S.jsx)("p",{children:"Loading..."}):Object(S.jsxs)("div",{className:"app-listconfigs",children:[Object(S.jsx)("h1",{children:"configs"}),this.state.configs.map((function(e){var n=t.state.instances.find((function(t){return t.uuid==e.uuid}));return Object(S.jsx)(W,{config:e,instance:n})}))]})}}]),n}(a.a.Component),z=(n(47),n(48),n(49),n(28)),V=n.n(z),A=function(t){Object(f.a)(n,t);var e=Object(b.a)(n);function n(t){var r;return Object(h.a)(this,n),(r=e.call(this,t)).state={rs:v("init.auth")},r}return Object(p.a)(n,[{key:"checkConfig",value:function(){var t=Object(l.a)(u.a.mark((function t(){var e,n;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.setState({rs:v("init.loading")}),t.next=3,this.doFetch(window.location.origin+"/config/launchers");case 3:if(e=t.sent){t.next=6;break}return t.abrupt("return");case 6:if(!(e.length<1)){t.next=9;break}return this.setState({rs:v("init.no-config")}),t.abrupt("return");case 9:return t.next=11,this.doFetch(window.location.origin+"/instance/instances");case 11:n=t.sent,this.setState({launcherConfigs:e,instances:n,rs:v("screen.launchers")});case 13:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"openConfigCreate",value:function(){var t=Object(l.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.setState({rs:v("init.config.create")});case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"onCreateConfig",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y(window.location.origin+"/config/launchers",e);case 2:if(n=t.sent,r=Object(c.a)(n,2),a=r[0],i=r[1],!a){t.next=9;break}return this.setState({rs:v("init.critical-error"),errorInfo:i}),t.abrupt("return");case 9:this.checkConfig();case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"doFetch",value:function(){var t=Object(l.a)(u.a.mark((function t(e){var n,r,a,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,g(e);case 2:if(n=t.sent,r=Object(c.a)(n,2),a=r[0],i=r[1],!a){t.next=9;break}return this.setState({rs:v("init.critical-error"),errorInfo:i}),t.abrupt("return",null);case 9:return t.abrupt("return",i);case 10:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){return console.log("rendering app"),Object(S.jsxs)("div",{class:"forgetg-root",children:[Object(S.jsx)(V.a,{action:this.checkConfig.bind(this)}),Object(S.jsx)(j,{rs:this.state.rs,path:"init.auth",children:"please authenticate"}),Object(S.jsx)(j,{rs:this.state.rs,path:"init.loading",children:"loading"}),Object(S.jsx)(j,{rs:this.state.rs,path:"init.no-config",children:Object(S.jsx)(R,{onCreateConfig:this.openConfigCreate.bind(this)})}),Object(S.jsx)(j,{rs:this.state.rs,path:"init.config.create",children:Object(S.jsx)(H,{onSubmit:this.onCreateConfig.bind(this)})}),Object(S.jsx)(j,{rs:this.state.rs,path:"init.critical-error",children:Object(S.jsx)(U,{info:this.state.errorInfo})}),Object(S.jsx)(j,{rs:this.state.rs,path:"screen",children:Object(S.jsxs)(I,{forceUpdateA:this.state.launcherConfigs,forceUpdateB:this.state.instances,tabs:[new B("screen.launchers","Launch Configs",Object(S.jsx)(q,{configs:this.state.launcherConfigs,instances:this.state.instances}))],activeTab:"screen.launchers",children:[Object(S.jsx)(D,{}),Object(S.jsx)(E,{})]})})]})}}]),n}(O),K=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,54)).then((function(e){var n=e.getCLS,r=e.getFID,a=e.getFCP,i=e.getLCP,s=e.getTTFB;n(t),r(t),a(t),i(t),s(t)}))};s.a.render(Object(S.jsx)(a.a.StrictMode,{children:Object(S.jsx)(A,{})}),document.getElementById("root")),K()}},[[53,1,2]]]);
//# sourceMappingURL=main.30ea424f.chunk.js.map